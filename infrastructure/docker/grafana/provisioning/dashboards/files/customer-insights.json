{
  "id": null,
  "uid": "customer-insights",
  "title": "Ecommerce Analytics - Customer Insights",
  "tags": ["ecommerce", "analytics", "customers"],
  "timezone": "browser",
  "refresh": "1m",
  "time": {
    "from": "now-7d",
    "to": "now"
  },
    "panels": [
      {
        "id": 1,
        "title": "üë• Customer Overview",
        "type": "stat",
        "gridPos": {
          "h": 6,
          "w": 24,
          "x": 0,
          "y": 0
        },
        "targets": [
          {
            "rawSql": "SELECT 'Total Customers' as metric, count(*) as value FROM ecommerce_analytics.customers_cdc WHERE _deleted = 0 UNION ALL SELECT 'Active Customers (with orders)', count(DISTINCT customer_id) FROM ecommerce_analytics.orders_cdc WHERE _deleted = 0 UNION ALL SELECT 'New Customers (Last 7d)', count(*) FROM ecommerce_analytics.customers_cdc WHERE _deleted = 0 AND fromUnixTimestamp64Milli(created_at) >= now() - INTERVAL 7 DAY",
            "format": 1,
            "queryType": "sql",
            "datasource": {
              "type": "grafana-clickhouse-datasource",
              "uid": "ClickHouse-Analytics"
            },
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "palette-classic"
            },
            "unit": "short",
            "decimals": 0
          }
        },
        "options": {
          "colorMode": "background",
          "graphMode": "area",
          "justifyMode": "center",
          "orientation": "horizontal"
        }
      },
      {
        "id": 2,
        "title": "üìä Customer Order Distribution",
        "type": "histogram",
        "gridPos": {
          "h": 8,
          "w": 12,
          "x": 0,
          "y": 6
        },
        "targets": [
          {
            "rawSql": "SELECT total_orders as orders_count, count(*) as customer_count FROM ecommerce_analytics.customer_metrics GROUP BY total_orders ORDER BY total_orders",
            "format": 1,
            "queryType": "sql",
            "datasource": {
              "type": "grafana-clickhouse-datasource",
              "uid": "ClickHouse-Analytics"
            },
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "palette-classic"
            },
            "unit": "short"
          }
        }
      },
      {
        "id": 3,
        "title": "üìà Customer Registration Trend",
        "type": "timeseries",
        "gridPos": {
          "h": 8,
          "w": 12,
          "x": 12,
          "y": 6
        },
        "targets": [
          {
            "rawSql": "SELECT toDate(fromUnixTimestamp64Milli(created_at)) as date, count(*) as new_customers FROM ecommerce_analytics.customers_cdc WHERE _deleted = 0 AND created_at >= toUnixTimestamp64Milli(now() - INTERVAL 30 DAY) GROUP BY date ORDER BY date",
            "format": 1,
            "queryType": "sql",
            "datasource": {
              "type": "grafana-clickhouse-datasource",
              "uid": "ClickHouse-Analytics"
            },
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "palette-classic"
            },
            "unit": "short"
          }
        }
      },
      {
        "id": 4,
        "title": "üèÖ VIP Customers (Top 20 by Orders)",
        "type": "table",
        "gridPos": {
          "h": 12,
          "w": 24,
          "x": 0,
          "y": 14
        },
        "targets": [
          {
            "rawSql": "SELECT name, email, total_orders, total_items_purchased, customer_lifespan_days, last_order_date FROM ecommerce_analytics.customer_metrics ORDER BY total_orders DESC LIMIT 20",
            "format": 1,
            "queryType": "sql",
            "datasource": {
              "type": "grafana-clickhouse-datasource",
              "uid": "ClickHouse-Analytics"
            },
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "thresholds"
            },
            "thresholds": {
              "steps": [
                {"color": "green", "value": null},
                {"color": "yellow", "value": 5},
                {"color": "red", "value": 10}
              ]
            }
          },
          "overrides": [
            {
              "matcher": {"id": "byName", "options": "total_orders"},
              "properties": [
                {"id": "color", "value": {"mode": "continuous-GrYlRd"}}
              ]
            }
          ]
        }
      }
    ],
    "templating": {
      "list": []
    },
    "annotations": {
    "list": []
  },
  "schemaVersion": 39,
  "version": 1,
  "links": []
}